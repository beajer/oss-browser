language: node_js
node_js: "12"
git:
  autocrlf: input
  symlinks: true
branches:
  only:
    - test/ci
os:
  - linux
  - osx
  - windows
before_install:
  - openssl aes-256-cbc -K $encrypted_8ebb1ef83f64_key -iv $encrypted_8ebb1ef83f64_iv -in github_deploy_key.enc -out deploy_key -d
  - chmod 600 deploy_key
  - eval `ssh-agent -s`
  - ssh-add deploy_key
  - git config user.name "Travis CI BOT"
  - git config user.email "travis@Travis-["$TRAVIS_OS_NAME"]-6.local"
  - |-
    if [ ! -d "$HOME/.ssh/" ];
    then mkdir $HOME/.ssh/;
    fi;
  - echo -e "Host github.com\n\tStrictHostKeyChecking no\n" >> $HOME/.ssh/config
  - git remote set-url origin git@github.com:beajer/oss-browser.git
script:
  - npm run build-crc64
  - if [[ "$TRAVIS_OS_NAME" != "windows" ]]; then npm run test-crc64 --no-sandbox; fi
  - git pull origin test/ci --no-rebase
  - git add node/
  - set hasChanged=$(git status -z | grep -e "node/");
  - |-
    if [[ $hasChanged != "" ]];
    then
    git commit -m "chore: [skip travis] build native addon on "$TRAVIS_OS_NAME"";
    git push origin HEAD:test/ci;
    else
    echo "Crc64 does not require compilation"
    fi;
    